import kl_http,kl_db,os,json,kl_log,kl_reg
regex=kl_reg
db=kl_db.mysql({
            'host':'localhost',
            'user':'root',
            'passwd':'adminrootkl',
            'db':'qiche',
            'prefix':'kl_',
            'charset':'utf8'
        })
http=kl_http.kl_http()
log=kl_log.kl_log('brand')


http.setheaders('''\
Content-Type:application/x-www-form-urlencoded
Host:www.epicc.com.cn
Origin:http://www.epicc.com.cn
Referer:http://www.epicc.com.cn/ecar/proposal/normalProposal
User-Agent:Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.116 Safari/537.36
X-Requested-With:XMLHttpRequest\
''')
#取承保验证码
url='http://www.epicc.com.cn/ecar/proposal/normalProposal'
postdata='''\
areaCode:41000000
cityCode:41010000
cityCodeLast:41010000
IKType:01
Preview:0
InterNo:/
Simulation:true
xubao:0
threeZuheFlag:0
threeZuhe:0
isnewcar:1
licenseno:豫*
isRenewal:0\
'''
prpcmainuniqueID=''
r=http.posturl(url,postdata)
if not http.lasterror:
    content=r.read().decode()
    idreg='<input.*?name\=\"prpcmain\.uniqueID\".*?value\=\"(.*?)\".*?>'
    mat=regex.findall(idreg,content)
    prpcmainuniqueID=mat[0]
    print(mat[0])

postdata='''\
cooperatorFlag:false
telContact:1
onlineService:1
appCallback:1
wangyiCon:1
faq:1
sendPrice:1
savePrice:1
carPeopleAccident:1
prpcmain.areaCode:41000000
prpcmain.areaCodeLast:41000000
prpcmain.cityCode:41010000
prpcmain.cityCodeLast:41010000
prpcitemCar.licenseno:008558
newCarEnableFlag_stepone:1
prpcmain.comcode:41010088
prpcmain.makecom:41010088
prpcmain.handlercode:4101880120
prpcmain.handler1code:4101880120
prpcmain.handler1code_uni:1241010107
prpcmain.handlercode_uni:1241010107
prpcmain.operatorcode:4101880120
branchcode:41010000
cityName:郑州
provinceName:河南
threeZuheFlag:0
threeZuhe:0
isrenewalonlycar:1
comcname:郑州
priceConfigKind:2
prpcmain.uniqueID:[prpcmain.uniqueID]
deliverAddressFlag:1
serverDateTime:2016/2/27 16:28
userPriceConf:1
BM_flag:0
itemKindFlag:caculateInfo
zancunmail:0
baojiaflag:0
taxEnable:1
BISigle:1
BZSigle:1
zSameAsFlag:000
phoneVerificationflag:0
driveAreaName:河南省内行驶
prpcmain.renewal:2
prpcitemCar.modelcode:DZAABD0001
prpcitemCar.purchaseprice:74000
isOutRenewal:0
lastHas050200:0
lastHas050500:0
lastHas050210:0
lastHas050310:0
lastHas050291:0
mrPurchasePrice:74000
oriPurchasePrice:77162
purchasePriceMin:51800
purchasePriceMax:96200
prpcitemCar.countrynature:03
prpcitemCar.useyears:0
newCarMonths:12
prpcitemCar.licenseflag:0
prpcitemCar.newCar_check:on
prpcitemCar.newcarflag:0
prpcitemCar.carloanflag:0
prpcitemCar.transfervehicleflag:0
prpcitemCar.nonlocalflag:0
isHBpriceconfig:0
renewalPackage:renewalPackage
hasRealTime:0
seatCountOri:5
prpcinsureds[1].insurednature:3
prpcinsureds[1].:1
prpcinsureds[0].insuredflag:0010000
prpcinsureds[1].insuredflag:1000000
prpcinsureds[2].insuredflag:0100000
BZ_timeChangeFlag:0
BI_timeChangeFlag:0
EnrollDateyc:1
carOwnerChangeFlag:0
prpcmain.changeFlag_renewal:0
cooperatorFlag:false
prpcmain.packageName:EconomyPackage
isNeedQueryCarModel:0
carInfoChangeFlag:1
guohutishi:0
purchasePrice_renewal:0
jyImportFlag:1
jyGroupPicData:/home/ecar/jy/pics/group/DZA2AB01/small/small_DZA2AB01_1.jpg,/home/ecar/jy/pics/group/DZA2AB01/small/small_DZA2AB01_1.jpg,/home/ecar/jy/pics/group/DZA2AB01/small/small_DZA2AB01_2.jpg
prpcitemCar.runmiles:10000
prpcitemCarext.nodamyearsbi:0
prpcmain.xzlastdamagedbi:0
prpcitemCar.frameno:LGXC16AF5G0008558
isFocus:0
prpcitemCar.vinno:LGXC16AF5G0008558
prpcitemCar.engineno:216005190
prpcitemCar.enrolldate:2016/02/27
prpcitemCar.brandname:桑塔纳SVW7160FHi
jyGroupName:请选择
jyDisplacement:请选择
jyGearboxName:请选择
jyParentVehName:请选择
jyFgwCode:请选择
prpcitemCar.seatcount:5
prpcmain.startdate:2016/02/28
prpcmain.starthour:0
prpcmain.enddate:2017/02/27
prpcmain.endhour:24
startDateBI:2016/02/28
starthourBI:0
endDateBI:2017/02/27
endhourBI:24
StartDateBIpro:24
endDateBIpro:24
startDateisChanged:0
prpcitemCar.TravelMilesvalue:1
guohuselect:0
haveLoan:2
WeiFaName:6
FullAmountName:8
RunAreaCodeName:11
assignDriver:2
prpcinsureds[2].insuredname:地地地
prpcinsureds[2].identifytype:01
prpcinsureds[2].identifynumber:410421198902050047
insuredIdentifyAddr:中中中中中吕中中
prpcinsureds[2].sex:2
prpcinsureds[2].age:27
prpcinsureds[2].mobile:13866666666
prpcinsureds[2].email:56464321321@qq.com
blackforSY:0
B2Flag:B2C
sumAmount:0
Currency:CNY
CurrencyName:人民币
ShortRateFlag:2
ShortRate:100.0000
prpcmain.businessnature:5
ThisDamagedCI:0
LastDamagedA:0
LastDamagedB:0
ThisDamagedA:0
ThisDamagedB:0
InsurerCode:0
vehicle_style_opt:K33
isRecord:0
BZ_selected:0
bzEnable:1
dateSeprateConf:0
remindFlag:0
bz_changeFlag:1
shanxiHighPriRem:0
HBNoFullAmount:0
prpcitemCar.AkeyRenewalGuoHu:0
isFirst2201:0
firstToCaculate:0
isNeedCompare:0
isNeedCal:0
CarKindCI:K33
TraveltaxAddress:10100
TraveltaxType:1
FTaxFlag:0
CarOwnerIdentifyType_BJ:01
starthourCI:0
endhourCI:24
carShipTax.taxpayertype:01
TAX_FLAG_SH:N
buytax:on
insuredCount:1
othersNumber:2
othersCount:1\
'''
yanzheng='http://www.epicc.com.cn/ecar/underwrite/underwrite/underwriteCheckProfit?time=1456561838870'
postdata=postdata.replace('[prpcmain.uniqueID]',prpcmainuniqueID)
r=http.posturl(yanzheng)
if not http.lasterror:
    content=r.read().decode()
    jso=json.loads(content)
    if jso['errorMsg']=='成功':
        pricelist=jso['CommonPackage']
        print(pricelist)
    else:
        print('error')
    print(jso)

postdata='''\
cooperatorFlag:false
telContact:1
onlineService:1
appCallback:1
wangyiCon:1
faq:1
sendPrice:1
savePrice:1
carPeopleAccident:1
prpcmain.areaCode:41000000
prpcmain.areaCodeLast:41000000
prpcmain.cityCode:41010000
prpcmain.cityCodeLast:41010000
prpcitemCar.licenseno:008558
newCarEnableFlag_stepone:1
prpcmain.comcode:41010088
prpcmain.makecom:41010088
prpcmain.handlercode:4101880120
prpcmain.handler1code:4101880120
prpcmain.handler1code_uni:1241010107
prpcmain.handlercode_uni:1241010107
prpcmain.operatorcode:4101880120
branchcode:41010000
cityName:郑州
provinceName:河南
threeZuheFlag:0
threeZuhe:0
isrenewalonlycar:1
comcname:郑州
priceConfigKind:2
prpcmain.uniqueID:[prpcmain.uniqueID]
deliverAddressFlag:1
serverDateTime:2016/2/27 14:36
userPriceConf:1
BM_flag:0
itemKindFlag:caculateInfo
zancunmail:0
baojiaflag:0
taxEnable:1
BISigle:1
BZSigle:1
zSameAsFlag:000
phoneVerificationflag:0
driveAreaName:河南省内行驶
prpcmain.renewal:2
prpcitemCar.modelcode:BJGAED0001
prpcitemCar.purchaseprice:76800
isOutRenewal:0
lastHas050200:0
lastHas050500:0
lastHas050210:0
lastHas050310:0
lastHas050291:0
mrPurchasePrice:76800
oriPurchasePrice:83400
purchasePriceMin:53760
purchasePriceMax:99840
prpcitemCar.countrynature:01
prpcitemCar.useyears:0
newCarMonths:12
prpcitemCar.licenseflag:0
prpcitemCar.newCar_check:on
prpcitemCar.newcarflag:0
prpcitemCar.carloanflag:0
prpcitemCar.transfervehicleflag:0
prpcitemCar.nonlocalflag:0
isHBpriceconfig:0
renewalPackage:renewalPackage
hasRealTime:0
seatCountOri:5
prpcinsureds[1].insurednature:3
prpcinsureds[1].:1
prpcinsureds[0].insuredflag:0010000
prpcinsureds[1].insuredflag:1000000
prpcinsureds[2].insuredflag:0100000
BZ_timeChangeFlag:0
BI_timeChangeFlag:0
EnrollDateyc:1
carOwnerChangeFlag:0
prpcmain.changeFlag_renewal:0
cooperatorFlag:false
prpcmain.packageName:EconomyPackage
isNeedQueryCarModel:0
carInfoChangeFlag:1
guohutishi:0
purchasePrice_renewal:0
jyIcon:B
jyImportFlag:0
brand/BJA8.jpg|北汽幻速
prpcitemCar.runmiles:10000
prpcitemCarext.nodamyearsbi:0
prpcmain.xzlastdamagedbi:0
prpcitemCar.frameno:LGXC16AF5G0008558
isFocus:0
prpcitemCar.vinno:LGXC16AF5G0008558
prpcitemCar.engineno:216005190
prpcitemCar.enrolldate:2016/02/27
prpcitemCar.brandname:宝骏LZW6465UVF
jyGroupName:请选择
jyDisplacement:请选择
jyGearboxName:请选择
jyParentVehName:请选择
jyFgwCode:请选择
prpcitemCar.seatcount:5
prpcmain.startdate:2016/02/28
prpcmain.starthour:0
prpcmain.enddate:2017/02/27
prpcmain.endhour:24
startDateBI:2016/02/28
starthourBI:0
endDateBI:2017/02/27
endhourBI:24
StartDateBIpro:24
endDateBIpro:24
startDateisChanged:0
prpcitemCar.TravelMilesvalue:1
guohuselect:0
haveLoan:2
WeiFaName:6
FullAmountName:8
RunAreaCodeName:11
assignDriver:2
prpcinsureds[2].insuredname:李若雯
prpcinsureds[2].identifytype:01
prpcinsureds[2].identifynumber:410421198902050047
insuredIdentifyAddr:加国中加国另另另中
prpcinsureds[2].sex:2
prpcinsureds[2].age:27
prpcinsureds[2].mobile:13598745896
prpcinsureds[2].email:735585858@qq.com
blackforSY:0
B2Flag:B2C
sumAmount:0
Currency:CNY
CurrencyName:人民币
ShortRateFlag:2
ShortRate:100.0000
prpcmain.businessnature:5
ThisDamagedCI:0
LastDamagedA:0
LastDamagedB:0
ThisDamagedA:0
ThisDamagedB:0
InsurerCode:0
vehicle_style_opt:K33
isRecord:0
BZ_selected:0
bzEnable:1
dateSeprateConf:0
remindFlag:0
bz_changeFlag:1
shanxiHighPriRem:0
HBNoFullAmount:0
prpcitemCar.AkeyRenewalGuoHu:0
isFirst2201:0
firstToCaculate:0
isNeedCompare:0
isNeedCal:0
CarKindCI:K33
TraveltaxAddress:10100
TraveltaxType:1
FTaxFlag:0
CarOwnerIdentifyType_BJ:01
starthourCI:0
endhourCI:24
carShipTax.taxpayertype:01
TAX_FLAG_SH:N
buytax:on
insuredCount:1
othersNumber:2
othersCount:1\
'''
#prpcmainuniqueID='0de6c1e4-1c03-445d-9c47-0e6586915eed'

#prpcmainuniqueID='4d352e8b-9c25-40b3-a1fe-8e7fd68336e4'
prpcmainuniqueID='c1349e2c-411e-4ac0-bd41-603d9092d444'
postdata=postdata.replace('[prpcmain.uniqueID]',prpcmainuniqueID)
url='http://www.epicc.com.cn/ecar/caculate/caculateForBatch?time=1456540973665'
r=http.posturl(url,postdata)
if not http.lasterror:
    content=r.read().decode()
    jso=json.loads(content)
    if jso['errorMsg']=='成功':
        pricelist=jso['CommonPackage']
        print(pricelist)
    else:
        print('error')
    print(jso)
#os.system('pause')